window.onload=function(){let c='<svg t="1629004332697" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3111" width="16" height="16"><path d="M914.56 463.78z m-110.53 0q0 30.34 14.63 55.81 14.63 25.46 40.63 40.09 26 14.63 54.72 14.63t55.26-14.63q26.55-14.63 40.63-40.09 14.09-25.47 14.09-55.27 0-29.8-14.09-55.27-14.08-25.46-40.63-40.63-26.55-15.17-55.26-15.17-28.72 0-54.72 15.17t-40.63 40.63q-14.63 25.47-14.63 54.73z m110.53 358.67z m-110.53 0q0 29.26 14.63 54.72 14.63 25.47 40.63 40.63 26 15.17 54.72 15.17t55.26-15.17q26.55-15.17 40.63-40.63 14.09-25.46 14.09-55.26 0-29.8-14.09-54.73-14.08-24.92-40.63-39.55Q942.72 713 914.01 713q-28.72 0-54.72 14.63t-40.63 39.55q-14.63 24.93-14.63 55.27z m-284.99 0z m-109.44 0q0 46.6 30.88 78.02 30.88 31.42 78.55 32.51 46.6-1.09 78.03-32.51 31.42-31.42 32.5-78.02-1.08-47.68-32.5-78.56-31.43-30.88-78.03-30.88-47.67 0-78.55 30.88-30.88 30.88-30.88 78.56z m109.44-358.67z m-109.44 0q0 47.68 30.88 78.56 30.88 30.88 78.55 31.97 46.6-1.09 78.03-31.97 31.42-30.88 32.5-78.56-1.08-46.59-32.5-77.47-31.43-30.88-78.03-33.06-47.67 2.17-78.55 33.06-30.88 30.88-30.88 77.47z m504.96-353.25z m-110.53 0q0 29.25 14.63 54.72t40.63 40.63q26 15.17 54.72 15.17t55.26-15.17q26.55-15.17 40.63-40.63 14.09-25.47 14.09-55.26 0-29.8-14.09-54.72-14.08-24.93-40.63-40.09Q942.72 0.01 914.01 0.01q-28.72 0-54.72 15.17t-40.63 40.09q-14.63 24.92-14.63 55.27zM109.44 822.45zM0 822.45q1.08 29.26 15.17 54.72 14.09 25.47 40.09 40.63 26 15.17 54.72 15.17t55.27-15.17q26.55-15.17 40.63-40.63 14.09-25.46 15.17-54.72-2.16-47.68-33.05-78.56-30.88-30.88-78.56-30.88-46.59 0-77.47 30.88Q1.09 774.77 0.01 822.45z" p-id="3112"></path></svg>',h='<svg t="1632228228676" class="icon" viewBox="0 0 1214 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15810" width="12" height="12"><path d="M964.352982 196.442274H250.01744A53.575166 53.575166 0 0 0 196.442274 250.01744v339.309382A53.575166 53.575166 0 0 0 250.01744 642.901988h214.300663l117.508196 117.508197a35.716777 35.716777 0 0 0 50.717824 0L750.052319 642.901988h214.300663a53.575166 53.575166 0 0 0 53.575166-53.575166V250.01744A53.575166 53.575166 0 0 0 964.352982 196.442274z" fill="#FFC824" p-id="15811"></path><path d="M607.185211 477.53331a35.716777 35.716777 0 0 1-35.716777-35.716777v-53.575166a35.716777 35.716777 0 1 1 71.433554 0v53.575166a35.716777 35.716777 0 0 1-35.716777 35.716777zM383.955354 477.53331a35.716777 35.716777 0 0 1-35.716777-35.716777v-53.575166a35.716777 35.716777 0 1 1 71.433554 0v53.575166a35.716777 35.716777 0 0 1-35.716777 35.716777zM830.415068 477.53331a35.716777 35.716777 0 0 1-35.716777-35.716777v-53.575166a35.716777 35.716777 0 1 1 71.433554 0v53.575166a35.716777 35.716777 0 0 1-35.716777 35.716777zM361.453784 71.433554h-17.858388a35.716777 35.716777 0 0 1 0-71.433554h17.858388a35.716777 35.716777 0 0 1 0 71.433554z" fill="#6B400D" p-id="15812"></path><path d="M607.185211 1024a107.150331 107.150331 0 0 1-75.719567-31.430764l-153.224974-153.224974H142.867108a142.867108 142.867108 0 0 1-142.867108-142.867108V142.867108a142.867108 142.867108 0 0 1 142.867108-142.867108h53.575166a35.716777 35.716777 0 0 1 0 71.433554H142.867108a71.433554 71.433554 0 0 0-71.433554 71.433554v553.610046a71.433554 71.433554 0 0 0 71.433554 71.433554h250.01744a35.716777 35.716777 0 0 1 25.358912 10.357865l163.582839 163.940007a35.716777 35.716777 0 0 0 50.717824 0l163.582839-163.940007a35.716777 35.716777 0 0 1 25.358912-10.357865h250.01744a71.433554 71.433554 0 0 0 71.433554-71.433554V142.867108a71.433554 71.433554 0 0 0-71.433554-71.433554H535.751657a35.716777 35.716777 0 0 1 0-71.433554h535.751657a142.867108 142.867108 0 0 1 142.867108 142.867108v553.610046a142.867108 142.867108 0 0 1-142.867108 142.867108h-235.373562l-153.224973 153.224974a107.150331 107.150331 0 0 1-75.719568 31.430764z" fill="#6B400D" p-id="15813"></path></svg>';Element.prototype.hasClass=function(t){return this.classList.contains(t)},Element.prototype.closest=function(e){var t=this,a=function(){if(e instanceof HTMLElement)return[e];try{e=document.querySelectorAll(e)}catch(t){}finally{var t=Object.prototype.toString.call(e).slice(8,-1);if(-1<["NodeList","HTMLCollection","Array"].indexOf(t))return[].slice.call(e)}}();do{if(-1<a.indexOf(t))return t}while(null!==(t=t.parentElement));return null};var A,a,q=[],p=[],u=[],g=!1,m=0,y=0,v=0,f=0,w=null,x=null,S=null,b=!1,P=null,E="",T="",n=null,i=null,o=null,C=null,r=1;function L(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()}function l(t){var e=t.pageNumber;setTimeout(()=>{!function(t){n&&clearInterval(n);n=null,q&&q.length&&function(t,l){var s=document.querySelector("#viewer .page").clientWidth;document.querySelectorAll(`.page[data-page-number='${l}'] .annotate`).forEach(t=>{t&&t.parentNode.removeChild(t)}),t.forEach(n=>{var r,t,i=JSON.parse(n.text),e=i.relateRect,o=`rgb(${i.color.r},${i.color.g},${i.color.b})`;i.contents&&(r=i.contents),i.page+1==l&&(1<e.length?e.forEach((t,e)=>{var a=document.createElement("div");a.classList.add("annotate"),a.setAttribute("data-type",n.type),"highlight"==n.type&&a.setAttribute("data-text",i.selectText||""),a.style=`background:${o};width:${t.width*s}px;height:${t.height*s}px;position:absolute;cursor:pointer;left:${t.x*s}px;top:${t.y*s}px;`,a.setAttribute("data-id",n.id),document.querySelector(`.page[data-page-number='${l}'] .textLayer`).appendChild(a),r&&0==e&&((e=document.createElement("span")).classList.add("comment-bar"),a.style.background,e.style="position:abaolute;left:-8px;top:-6px;z-index:120;",e.innerHTML=h,e.setAttribute("data-title",r),a.appendChild(e))}):((e=document.createElement("div")).setAttribute("data-id",i.id),e.setAttribute("data-type",n.type),e.classList.add("annotate"),"highlight"==n.type&&e.setAttribute("data-text",i.selectText||""),"rect"==n.type&&(e.setAttribute("data-path",i.path),(t=document.createElement("div")).classList.add("annotate-head"),e.appendChild(t),(t=document.createElement("div")).classList.add("annotate-resize"),e.appendChild(t),t.innerHTML=c),i.relateRect&&i.relateRect.length&&(e.style=`background:${o};width:${i.relateRect[0].width*s}px;height:${i.relateRect[0].height*s}px;position:absolute;cursor:pointer;left:${i.relateRect[0].x*s}px;top:${i.relateRect[0].y*s}px;`,document.querySelector(`.page[data-page-number='${l}'] .textLayer`).appendChild(e)),r&&((t=document.createElement("span")).classList.add("comment-bar"),e.style.background,t.style="position:abaolute;left:-8px;top:-6px;z-index:120;",t.innerHTML=h,t.setAttribute("data-title",r),e.appendChild(t))))}),function(t){var a,n,e,r;i&&(a=i,q&&0!=q.length&&(q.filter(t=>{var e=JSON.parse(t.text);return t.id==a&&(n=parseInt(e.page)+1,!0)}).length&&((e=document.querySelector(`.textLayer .annotate[data-id = '${a}']`))?(A.currentPageNumber=n,A._currentPage=A.currentPageNumber,r=parseInt(e.style.top),o&&clearTimeout(o),o=setTimeout(()=>{var t=document.querySelector("#viewerContainer");t.scrollTop=t.scrollTop+r-100,document.querySelectorAll(`.textLayer .annotate[data-id = '${a}']`).forEach(t=>{t&&t.classList.add("active")})},0)):(A.currentPageNumber=n,A._currentPage=n,o&&clearTimeout(o),this.setTime=setTimeout(()=>{var e,t=document.querySelector(`.textLayer .annotate[data-id = '${a}']`);t&&(e=parseInt(t.style.top),setTimeout(()=>{var t=document.querySelector("#viewerContainer");t.scrollTop=t.scrollTop+e-100},30),document.querySelectorAll(`.textLayer .annotate[data-id = '${a}']`).forEach(t=>{t&&t.classList.add("active")}))},0))),n==t&&(i="")))}(l)}(q,t)}(e)},10)}function d(e){var a,t,n,r;q.length&&(a=null,q.forEach(t=>{t.id==e&&(a=t)}),a&&(document.querySelectorAll(".annotate.active").forEach(t=>{t.classList.remove("active")}),(r=document.querySelector(`.annotate[data-id = '${e}']`))?(t=r.closest(".page").getAttribute("data-page-number"),A.currentPageNumber=parseInt(t),n=parseInt(r.style.top),setTimeout(()=>{var t=document.querySelector("#viewerContainer");t.scrollTop=t.scrollTop+n-60},30),document.querySelectorAll(`.annotate[data-id = '${e}']`).forEach(t=>{t.classList.add("active")}),i=""):(i=e,r=JSON.parse(a.text),A.currentPageNumber=parseInt(r.page)+1)))}var t=document.querySelector("#viewerContainer");function $(){A._currentPage;var t=document.querySelector(`.page[data-page-number="${A._currentPage}"]`).querySelector("canvas"),t=(document.querySelector(".showpdf"),t.getBoundingClientRect());return{top:t.top,left:t.left}}function M(t,e,a,n,r,i){var o=document.querySelector("#viewer .page").clientWidth,l=document.createElement("canvas");l.width=e.width,l.height=e.height;var s=l.getContext("2d"),c=n.closest(".page").querySelector("canvas"),n=(window.devicePixelRatio||1)/(s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1);s.drawImage(c,e.left*n,e.top*n,e.width*n,e.height*n,0,0,e.width,e.height);l=function(t){for(var e=window.atob(t),a=e.length,n=new Uint8Array(a),r=0;r<a;r++)n[r]=e.charCodeAt(r);return n.buffer}(l.toDataURL().replace(/^data:image\/\w+;base64,/,"")),o=[{x:e.left/o,y:e.top/o,width:e.width/o,height:e.height/o}];i.relateRect=o,i.pdfName=E,i.path=t,a&&(r.setAttribute("data-id",i.id),r.setAttribute("data-path",t),q.push({id:i.id,text:JSON.stringify(i),type:"rect",page:i.page,width:e.width,height:e.height,pdfName:E})),window.parent.postMessage({type:"createRect",imagePath:t,dataBuffer:l,annotations:q,isNew:a,data:i,relateRect:o,imageOptions:e,_viewMark:C},"*"),setTimeout(()=>{a&&(r=null)},500)}window.addEventListener("message",function(t){switch(t.data.type){case"openPDF":t.data._viewMark&&(C=t.data._viewMark),E=t.data.pdfName,T=t.data.basename,q=t.data.annotations,t.data.openProtocol,i=t.data.id,setTimeout(()=>{PDFViewerApplication.open(t.data.data).then(()=>{(A=PDFViewerApplication.pdfViewer)._currentPage=1,PDFViewerApplication.pdfDocument.getData().then(t=>{a=new pdfAnnotate.AnnotationFactory(t)}),t.data.id&&d(t.data.id)}),PDFViewerApplication.eventBus.on("pagerendered",l)},300);break;case"closePDF":break;case"showAnnotate":d(t.data.id);break;case"exportAnnotatePDF":var e,s=document.querySelector("#viewer .page").clientWidth;new Date;setTimeout(()=>{q.forEach(t=>{var o=JSON.parse(t.text);1!=r&&a.deleteAnnotation(o.id);var e=o.relateRect,l={page:o.page,rect:o.rect,contents:o.contents||"",author:"",color:o.color,opacity:.8,id:o.id,quadPoints:[],fill:""};e.forEach(t=>{var e=parseInt(t.x*s+""),a=parseInt(t.y*s+""),n=parseInt(t.width*s+""),r=parseInt(t.height*s+""),i=A._pages[o.page].viewport.convertToPdfPoint(e,a),t=i[0],i=i[1],a=A._pages[o.page].viewport.convertToPdfPoint(e+n,a+r),r=a[0],a=a[1];l.quadPoints.push(t,a,r,a,t,i,r,i)}),"highlight"==t.type?l.rect.length<4||a.createHighlightAnnotation(l):(l.fill=o.color,l.opacity=.3,l.quadPoints.length&&(l.rect=[l.quadPoints[2],l.quadPoints[3],l.quadPoints[4],l.quadPoints[5]],a.createSquareAnnotation(l)))});new Date;e=a.write(),r++,setTimeout(async()=>{window.parent.postMessage({type:"exportAnnotatePDF",pdfData:e,_viewMark:C},"*")},200)},200)}},!1),window.parent.postMessage({test:"这是测试"},"*"),document.querySelector(".annotate-bar").addEventListener("click",function(t){var e,a,n,r,i,o,l,s,c,d,p,u=t.target;(u.hasClass("annoate-btn")||u.closest(".annoate-btn"))&&("highlight"==(e=(u.hasClass("annoate-btn")?u:u.closest(".annoate-btn")).getAttribute("title"))?function(a){var e=window.getSelection();if(S){var n,t=document.querySelector(".annotate.active");t&&(n=t.getAttribute("data-id"),r=document.querySelectorAll(".annotate.active"),b=`rgb(${a.r},${a.g},${a.b})`,r.forEach(t=>{t.style.background=b}),q.forEach(t=>{var e;t.id==n&&((e=JSON.parse(t.text)).color=a,t.text=JSON.stringify(e))}),window.parent.postMessage({type:"updateHighlight",annotations:q,_viewMark:C},"*"))}else{var r=e.getRangeAt(0),i=r.getClientRects();let t=function(){let t=window.getSelection().getRangeAt(0).getBoundingClientRect(),e=$(),a=t.x-e.left,n=t.y-e.top,r=a+t.width,i=n+t.height;var o=[a,n,r,i];var l=A._pages[A._currentPage-1].viewport.convertToPdfPoint(a,n);a=l[0],n=l[1];l=A._pages[A._currentPage-1].viewport.convertToPdfPoint(r,i);return r=l[0],i=l[1],[a,n,r,i].concat(o)}();for(var o="",l=r.cloneContents(),s=0;s<l.children.length;s++)o+=l.children[s].textContent+" ";o=(o=o.trim())||e.toString();var c=document.querySelector("#viewer .page").clientWidth;if(1==i.length)var d=t.slice(0,4),p=[{x:t[4]/c,y:t[5]/c,width:(t[6]-t[4])/c,height:(t[7]-t[5])/c}],u={id:L(),page:A._currentPage-1,rect:d,contents:"",author:"",color:a,opacity:1,quadPoints:null,selectText:"",relateRect:null,pageWidth:c};else{var u={id:L(),page:A._currentPage-1,rect:t.slice(0,4),contents:"",author:"",color:a,opacity:1,quadPoints:null,selectText:"",relateRect:null,pageWidth:c},h=$(),g=[],m=[],p=[];i=function(t){for(var e={1:[t[0]]},a=1,n=t[0].bottom,r=1;r<t.length;r++){e[a]||(e[a]=[]);var i=t[r].height;t[r].top<n&&t[r].bottom<n+i/3||(e[++a]||(e[a]=[]),n=t[r].bottom),e[a].push(t[r])}var o,l=[];for(o in e){let a,n,r,i;e[o].forEach((t,e)=>{0==e?(a=t.x,n=t.y,r=t.bottom,i=t.right):(t.x<a&&(a=t.x),t.y<n&&(n=t.y),t.bottom>r&&(r=t.bottom),t.right>i&&(i=t.right))});var s={x:a,y:n,top:a,left:n,bottom:r,right:i,width:i-a,height:r-n};l.push(s)}return l}(i=2<i.length?function(e){var a=[];for(let t=0;t<e.length;t++)for(var n,r,i=t;i<e.length;i++)t!=i&&(n=e[t],r=e[i],n.x<=r.x&&n.y<=r.y&&n.bottom>=r.bottom&&n.right>=r.right&&a.push(i));var o=[];{if(a.length){for(let t=0;t<e.length;t++)-1==a.indexOf(t)&&o.push(e[t]);return o}return e}}(i):i);for(s=0;s<i.length;s++){var y=i[s],v=y.x-h.left,f=y.y-h.top,w=v+y.width,x=f+y.height;m.push({x:v,y:f,width:y.width,height:y.height}),p.push({x:v/c,y:f/c,width:y.width/c,height:y.height/c}),0<s&&(f+=2);v=A._pages[A._currentPage-1].viewport.convertToPdfPoint(v,f),f=v[0],v=v[1],w=A._pages[A._currentPage-1].viewport.convertToPdfPoint(w,x),x=w[0],w=w[1];g.push(f,w,x,w,f,v,x,v)}u.quadPoints=g}u.relateRect=p,u.selectText=o;var b=`rgb(${a.r},${a.g},${a.b})`;1<i.length?m.forEach(t=>{var e=document.createElement("div");e.classList.add("annotate"),e.setAttribute("data-id",u.id),e.setAttribute("data-type","highlight"),e.setAttribute("data-text",o||""),e.setAttribute("style",`background:${b};width:${t.width}px;height:${t.height}px;position:absolute;cursor:pointer;left:${t.x}px;top:${t.y}px;`),document.querySelector(`[data-page-number='${A._currentPage}'] .textLayer`).appendChild(e)}):((d=document.createElement("div")).classList.add("annotate"),d.setAttribute("data-id",u.id),d.setAttribute("data-type","highlight"),d.setAttribute("data-text",o||""),d.setAttribute("style",`background:${b};width:${t[6]-t[4]}px;height:${t[7]-t[5]}px;position:absolute;cursor:pointer;left:${t[4]}px;top:${t[5]}px;`),document.querySelector(`[data-page-number='${A._currentPage}'] .textLayer`).appendChild(d));new Date;u.relateRect=p||[],u.pdfName=E,q.push({id:u.id,page:u.page,text:JSON.stringify(u),type:"highlight",selectText:o,pdfName:u.pdfName}),window.parent.postMessage({type:"createHighlight",annotations:q,_viewMark:C},"*")}}({r:(i=u.getAttribute("data-color").split(","))[0],g:i[1],b:i[2]}):"rect"==e?(b=!b)?window.parent.postMessage({type:"create rect annotate",_viewMark:C},"*"):window.parent.postMessage({type:"cancel create rect annotate",_viewMark:C},"*"):"delete annotate"==e?(d=document.querySelector(".annotate.active"))&&(p=d.getAttribute("data-id"),a=null,q.forEach((t,e)=>{t.id==p&&(a=e)}),-1<a&&(q.splice(a,1),window.parent.postMessage({type:"deleteAnnotate",annotations:q,_viewMark:C},"*"),document.querySelectorAll(`.annotate[data-id="${p}"]`).forEach(t=>{var e=t.parentElement;e&&e.removeChild(t)}),window.parent.postMessage({type:"delete mindmap annotate",id:p,_viewMark:C},"*"))):"comment"==e?(d=document.querySelector(".annotate.active"))&&(p=d.getAttribute("data-id"),n=d.closest(".page"),(t=d.querySelector(".comment-bar"))&&(r=t.getAttribute("data-title")),u=parseInt(d.style.left),i=parseInt(d.style.top),t=parseInt(d.clientHeight),(o=document.createElement("div")).classList.add("annotate-comment"),l=document.createElement("textarea"),o.appendChild(l),o.style.left=u+"px",o.style.top=i+t+10+"px",o.style.minWidth="100px",o.style.minHeight="80px",o.style.position="absolute",o.style.zIndex=200,o.style.backgroundColor="rgb(242 253 184)",o.style.color="#333",n.appendChild(o),(s=document.createElement("span")).innerText="X",s.style.position="absolute",s.style.color="red",s.style.right="10px",s.style.top="10px",s.style.zIndex="20",s.style.fontSize="12px",s.style.cursor="pointer",o.appendChild(s),s.onclick=function(){s.onclick=null,n.removeChild(o),o.innerText="",o=null},r&&(l.value=r),c="",l.onfocus=function(){c=this.value.trim()},l.onblur=function(){var t,e,a=this.value.trim();a!=c&&(q.forEach(t=>{var e=JSON.parse(t.text);e.id==p&&(e.contents=a,e.commentTime=+new Date,t.text=JSON.stringify(e))}),window.parent.postMessage({type:"comment",_viewMark:C,annotations:q},"*"),a?(t=d.querySelector(".comment-bar"))?t.setAttribute("data-title",a):((e=document.createElement("span")).classList.add("comment-bar"),d.style.background,e.style="position:abaolute;left:-8px;top:-6px;z-index:120;",e.innerHTML=h,e.setAttribute("data-title",a),d.appendChild(e)):(e=d.querySelector(".comment-bar"))&&d.removeChild(e)),l.onfocus=null,l.onblur=null,n.removeChild(o),c=""}):"search"==e&&(d=document.querySelector(".annotate.active"))&&(p=d.getAttribute("data-id"),window.parent.postMessage({type:"search",id:p,_viewMark:C})))}),t.addEventListener("mousedown",function(t){var e;if(m=t.pageX,y=t.pageY,S=null,document.querySelectorAll(".annotate.active").forEach(t=>{t&&t.classList.remove("active")}),(r=t.target).closest(".page")&&(e=(n=r.closest(".page")).getAttribute("data-page-number"),A._currentPage=parseInt(e),x=n.querySelector(".textLayer")),b||(p=[],u=[]),r.hasClass("annotate-head")||r.hasClass(".annotate-resize")||r.closest(".annotate-resize")){var a=r.closest(".annotate");return i=r.hasClass("annotate-head")?"move":"resize",void(P={ele:a,left:parseInt(a.style.left),top:parseInt(a.style.top),width:a.clientWidth,height:a.clientHeight,type:i})}var n=$(),a=r=t.pageX-n.left,t=i=t.pageY-n.top;u.push(r),u.push(i);var r=(n=A._pages[A._currentPage-1].viewport.convertToPdfPoint(r,i))[0],i=n[1];p.push(r),p.push(i),b&&(g=!0,(w=document.createElement("div")).classList.add("annotate"),w.setAttribute("data-type","rect"),w.setAttribute("style",`position:absolute;background:#f9e9cc;left:${a-2}px;top:${t-2}px`),(t=document.createElement("div")).classList.add("annotate-head"),w.appendChild(t),(t=document.createElement("div")).classList.add("annotate-resize"),w.appendChild(t),t.innerHTML=c,x.appendChild(w),x.style.userSelect="none")}),t.addEventListener("click",function(t){var e=t.target;{var a,n,r,i,o,l;e&&(e.hasClass("comment-bar")||e.closest(".comment-bar"))&&(a=(e.hasClass("comment-bar")?e:e.closest(".comment-bar")).getAttribute("data-title"),(r=e.closest(".annotate"))&&(n=parseInt(r.style.left),t=parseInt(r.style.top),r=parseInt(r.clientHeight),i=e.closest(".page"),(o=document.createElement("div")).classList.add("annotate-comment"),o.style.left=n+"px",o.style.top=t+r+10+"px",o.style.minWidth="100px",o.style.minHeight="80px",o.style.position="absolute",o.style.padding="10px",o.style.zIndex=200,o.style.backgroundColor="rgb(242 253 184)",o.style.color="#333",o.innerText=a||"",o.style.paddingTop="4px",i.appendChild(o),(l=document.createElement("span")).innerText="X",l.style.float="right",l.style.color="red",l.style.right="10px",l.style.top="10px",l.style.fontSize="12px",l.style.cursor="pointer",o.appendChild(l),l.onclick=function(){l.onclick=null,i.removeChild(o),o.innerText="",o=null}))}}),t.addEventListener("mousemove",function(t){if(P)return v=t.pageX-m,f=t.pageY-y,void("move"==P.type?(P.ele.style.left=P.left+v+"px",P.ele.style.top=P.top+f+"px"):(P.ele.style.width=P.width+v+"px",P.ele.style.height=P.height+f+"px"));g&&b&&(v=t.pageX-m,f=t.pageY-y,w.style.width=v-2+"px",w.style.height=f-2+"px")}),t.addEventListener("mouseup",function(t){var e,a,n,r,i,o,l,s=document.querySelector("#viewer .page").clientWidth;if(P){var c=P.ele.getAttribute("data-id"),d="";return q.forEach(t=>{var e,a,n;t.id==c&&(e=JSON.parse(t.text),t.width=P.ele.clientWidth,t.height=P.ele.clientHeight,a=parseInt(P.ele.style.left),n=parseInt(P.ele.style.top),d=e.path,n=[{x:a/s,y:n/s,width:t.width/s,height:t.height/s}],e.relateRect=n,t.text=JSON.stringify(e))}),M(d,{left:parseInt(P.ele.style.left),top:parseInt(P.ele.style.top),width:P.ele.clientWidth,height:P.ele.clientHeight},!1,x,P.ele,{}),void(P=null)}g&&b&&(b=!1,e={id:L(),page:A._currentPage-1,rect:p.slice(),contents:"",author:"",color:{r:249,g:233,b:204},opacity:1,path:"",relateRect:null,pdfName:"",pageWidth:s},a=parseInt(w.style.left),n=parseInt(w.style.top),r=v,i=f,o=+new Date,l=E.lastIndexOf("/"),M(E.substr(0,l+1)+T+"-"+o+".png",{left:a,top:n,width:r,height:i},!0,x,w,e),x.style.userSelect="text",u=[],y=m=0,b=g=!(p=[]))}),t.addEventListener("click",function(t){var e,a,n,r,i,o=t.target;o.hasClass("annotate")||o.closest(".annotate")?(S=!0,o.hasClass("annotate")?e=o:o.closest(".annotate")&&(e=o.closest(".annotate")),e&&(a=e.getAttribute("data-id"),document.querySelectorAll(`.annotate[data-id = '${a}']`).forEach(t=>{t.classList.contains("active")||t.classList.add("active")}),i=q.filter(t=>t.id==a),n=e.getAttribute("data-type"),i.length&&(r={id:a,type:n,action:"create pdf annotate",text:i[0].text,path:"",width:0,height:0,selectText:""},"rect"==n?(t=e.getAttribute("data-path"),o=e.clientWidth,i=e.clientHeight,r.path=t,r.width=o,r.height=i):r.selectText=e.getAttribute("data-text"),window.parent.postMessage({id:a,type:"showMindmapAnnotate",annotateType:n,path:r.path||"",selectText:r.selectText||"",data:r,_viewMark:C},"*")))):this.selectAnnotate=null})};